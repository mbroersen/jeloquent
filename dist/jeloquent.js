!function webpackUniversalModuleDefinition(t,r){"object"==typeof exports&&"object"==typeof module?module.exports=r():"function"==typeof define&&define.amd?define("Jeloquent",[],r):"object"==typeof exports?exports.Jeloquent=r():t.Jeloquent=r()}(window,(function(){return function(t){var r={};function __webpack_require__(o){if(r[o])return r[o].exports;var a=r[o]={i:o,l:!1,exports:{}};return t[o].call(a.exports,a,a.exports,__webpack_require__),a.l=!0,a.exports}return __webpack_require__.m=t,__webpack_require__.c=r,__webpack_require__.d=function(t,r,o){__webpack_require__.o(t,r)||Object.defineProperty(t,r,{enumerable:!0,get:o})},__webpack_require__.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},__webpack_require__.t=function(t,r){if(1&r&&(t=__webpack_require__(t)),8&r)return t;if(4&r&&"object"==typeof t&&t&&t.__esModule)return t;var o=Object.create(null);if(__webpack_require__.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:t}),2&r&&"string"!=typeof t)for(var a in t)__webpack_require__.d(o,a,function(r){return t[r]}.bind(null,a));return o},__webpack_require__.n=function(t){var r=t&&t.__esModule?function getDefault(){return t.default}:function getModuleExports(){return t};return __webpack_require__.d(r,"a",r),r},__webpack_require__.o=function(t,r){return Object.prototype.hasOwnProperty.call(t,r)},__webpack_require__.p="",__webpack_require__(__webpack_require__.s=0)}([function(t,r,o){"use strict";function _defineProperties(t,r){for(var o=0;o<r.length;o++){var a=r[o];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}o.r(r),o.d(r,"Connection",(function(){return k})),o.d(r,"Collection",(function(){return v})),o.d(r,"Database",(function(){return O})),o.d(r,"Store",(function(){return R})),o.d(r,"Table",(function(){return m})),o.d(r,"Model",(function(){return g})),o.d(r,"Field",(function(){return a})),o.d(r,"ForeignKey",(function(){return i})),o.d(r,"Relation",(function(){return u})),o.d(r,"BelongsTo",(function(){return p})),o.d(r,"HasOne",(function(){return h})),o.d(r,"HasMany",(function(){return c})),o.d(r,"HasManyThrough",(function(){return l})),o.d(r,"HasOneThrough",(function(){return d})),o.d(r,"MorphOne",(function(){return y})),o.d(r,"MorphTo",(function(){return b})),o.d(r,"ConnectionAdapter",(function(){return P})),o.d(r,"ConnectionAdapterFactory",(function(){return S})),o.d(r,"QueueMessage",(function(){return C}));var a=function(){function Field(t,r){!function _classCallCheck(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}(this,Field),this.isPrimary=null!=r&&r,this.$name=t,this.fieldValue=null,this.previousValue=void 0,this.$parent=null}return function _createClass(t,r,o){return r&&_defineProperties(t.prototype,r),o&&_defineProperties(t,o),t}(Field,[{key:"setName",value:function setName(){return this}},{key:"setup",value:function setup(t){return this.$parent=t,this.setName().setParentProperties()}},{key:"tableSetup",value:function tableSetup(){}},{key:"setParentProperties",value:function setParentProperties(){var t=this;return Object.defineProperty(this.$parent,this.$name,{get:function get(){return t.value},set:function set(r){var o;void 0===t.previousValue&&(t.previousValue=JSON.parse(JSON.stringify(null!==(o=t.value)&&void 0!==o?o:r)));t.previousValue=JSON.parse(JSON.stringify(t.value)),t.value=r}}),this.setFillPropertyOnParent(),this}},{key:"setFillPropertyOnParent",value:function setFillPropertyOnParent(){var t=this;Object.defineProperty(this.$parent,"_".concat(this.$name),{set:function set(r){t.previousValue=JSON.parse(JSON.stringify(t.value)),t.fieldValue=r}})}},{key:"resetDirty",value:function resetDirty(){this.previousValue=JSON.parse(JSON.stringify(this.fieldValue))}},{key:"toJson",value:function toJson(){var t={};return t[this.$name]=this.fieldValue,JSON.parse(JSON.stringify(t))}},{key:"isDirty",get:function get(){return this.fieldValue!=this.previousValue}},{key:"value",get:function get(){return this.fieldValue},set:function set(t){this.fieldValue=t}}]),Field}();function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(t){return typeof t}:function _typeof(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function ForeignKey_defineProperties(t,r){for(var o=0;o<r.length;o++){var a=r[o];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}function _setPrototypeOf(t,r){return(_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(t,r){return t.__proto__=r,t})(t,r)}function _createSuper(t){var r=function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function _createSuperInternal(){var o,a=_getPrototypeOf(t);if(r){var i=_getPrototypeOf(this).constructor;o=Reflect.construct(a,arguments,i)}else o=a.apply(this,arguments);return _possibleConstructorReturn(this,o)}}function _possibleConstructorReturn(t,r){return!r||"object"!==_typeof(r)&&"function"!=typeof r?function _assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):r}function _getPrototypeOf(t){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var i=function(t){!function _inherits(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),r&&_setPrototypeOf(t,r)}(ForeignKey,t);var r=_createSuper(ForeignKey);function ForeignKey(t,o){var a;return function ForeignKey_classCallCheck(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}(this,ForeignKey),(a=r.call(this,t)).foreignKey=null!=t?t:o,a}return function ForeignKey_createClass(t,r,o){return r&&ForeignKey_defineProperties(t.prototype,r),o&&ForeignKey_defineProperties(t,o),t}(ForeignKey,[{key:"tableSetup",value:function tableSetup(t){t.addIndex(this.foreignKey)}},{key:"setFillPropertyOnParent",value:function setFillPropertyOnParent(){var t=this;Object.defineProperty(this.$parent,"_".concat(this.$name),{set:function set(r){t.$parent.removeFromIndex(t),t.fieldValue=r,t.$parent.addToIndex(t)}})}},{key:"value",get:function get(){return this.fieldValue},set:function set(t){this.fieldValue=t}}]),ForeignKey}(a);function Relation_typeof(t){return(Relation_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(t){return typeof t}:function _typeof(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Relation_defineProperties(t,r){for(var o=0;o<r.length;o++){var a=r[o];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}function Relation_setPrototypeOf(t,r){return(Relation_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(t,r){return t.__proto__=r,t})(t,r)}function Relation_createSuper(t){var r=function Relation_isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function _createSuperInternal(){var o,a=Relation_getPrototypeOf(t);if(r){var i=Relation_getPrototypeOf(this).constructor;o=Reflect.construct(a,arguments,i)}else o=a.apply(this,arguments);return Relation_possibleConstructorReturn(this,o)}}function Relation_possibleConstructorReturn(t,r){return!r||"object"!==Relation_typeof(r)&&"function"!=typeof r?function Relation_assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):r}function Relation_getPrototypeOf(t){return(Relation_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var u=function(t){!function Relation_inherits(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),r&&Relation_setPrototypeOf(t,r)}(Relation,t);var r=Relation_createSuper(Relation);function Relation(t,o,a){var i;!function Relation_classCallCheck(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}(this,Relation);var u=null!=a?a:t.snakeCaseClassName();return(i=r.call(this,u)).model=t,i.foreignKey=o,i}return function Relation_createClass(t,r,o){return r&&Relation_defineProperties(t.prototype,r),o&&Relation_defineProperties(t,o),t}(Relation,[{key:"tableSetup",value:function tableSetup(t){t.addIndex(this.foreignKey)}},{key:"getRelationalFields",value:function getRelationalFields(){return[new i(this.foreignKey)]}},{key:"setFillPropertyOnParent",value:function setFillPropertyOnParent(){var t=this;Object.defineProperty(this.$parent,"_".concat(this.$name),{set:function set(r){Array.isArray(r)||(r=[r]),r.forEach((function(r){t.model.ids().includes(r.id)||t.model.insert(r)}))}})}}]),Relation}(a);function HasManyThrough_typeof(t){return(HasManyThrough_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(t){return typeof t}:function _typeof(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function _toConsumableArray(t){return function _arrayWithoutHoles(t){if(Array.isArray(t))return _arrayLikeToArray(t)}(t)||function _iterableToArray(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||function _unsupportedIterableToArray(t,r){if(!t)return;if("string"==typeof t)return _arrayLikeToArray(t,r);var o=Object.prototype.toString.call(t).slice(8,-1);"Object"===o&&t.constructor&&(o=t.constructor.name);if("Map"===o||"Set"===o)return Array.from(t);if("Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return _arrayLikeToArray(t,r)}(t)||function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _arrayLikeToArray(t,r){(null==r||r>t.length)&&(r=t.length);for(var o=0,a=new Array(r);o<r;o++)a[o]=t[o];return a}function HasManyThrough_defineProperties(t,r){for(var o=0;o<r.length;o++){var a=r[o];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}function _get(t,r,o){return(_get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function _get(t,r,o){var a=function _superPropBase(t,r){for(;!Object.prototype.hasOwnProperty.call(t,r)&&null!==(t=HasManyThrough_getPrototypeOf(t)););return t}(t,r);if(a){var i=Object.getOwnPropertyDescriptor(a,r);return i.get?i.get.call(o):i.value}})(t,r,o||t)}function HasManyThrough_setPrototypeOf(t,r){return(HasManyThrough_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(t,r){return t.__proto__=r,t})(t,r)}function HasManyThrough_createSuper(t){var r=function HasManyThrough_isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function _createSuperInternal(){var o,a=HasManyThrough_getPrototypeOf(t);if(r){var i=HasManyThrough_getPrototypeOf(this).constructor;o=Reflect.construct(a,arguments,i)}else o=a.apply(this,arguments);return HasManyThrough_possibleConstructorReturn(this,o)}}function HasManyThrough_possibleConstructorReturn(t,r){return!r||"object"!==HasManyThrough_typeof(r)&&"function"!=typeof r?function HasManyThrough_assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):r}function HasManyThrough_getPrototypeOf(t){return(HasManyThrough_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var l=function(t){!function HasManyThrough_inherits(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),r&&HasManyThrough_setPrototypeOf(t,r)}(HasManyThrough,t);var r=HasManyThrough_createSuper(HasManyThrough);function HasManyThrough(t,o,a,i){var u;return function HasManyThrough_classCallCheck(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}(this,HasManyThrough),(u=r.call(this,t,a)).model=t,u.throughModel=o,u.localKey=null!=i?i:"id",u}return function HasManyThrough_createClass(t,r,o){return r&&HasManyThrough_defineProperties(t.prototype,r),o&&HasManyThrough_defineProperties(t,o),t}(HasManyThrough,[{key:"setName",value:function setName(){return this._lcThroughModelClassName=this.throughModel.snakeCaseClassName(),this._lcModelClassName=this.model.snakeCaseClassName(),this._lcParentClassName=this.$parent.constructor.snakeCaseClassName(),this.foreignKey="".concat(this._lcThroughModelClassName,"_id"),this.$name="".concat(this._lcModelClassName,"s"),this}},{key:"tableSetup",value:function tableSetup(){this.model.addIndex(this.indexName)}},{key:"getRelationalFields",value:function getRelationalFields(){return[]}},{key:"setParentProperties",value:function setParentProperties(){_get(HasManyThrough_getPrototypeOf(HasManyThrough.prototype),"setParentProperties",this).call(this)}},{key:"indexName",get:function get(){return"".concat(this._lcThroughModelClassName,".").concat(this._lcParentClassName,"_id")}},{key:"value",get:function get(){var t,r=this.model.className(),o=globalThis.Store.database().indexes(r);if(Object.prototype.hasOwnProperty.call(o,this.indexName))return globalThis.Store.database().find(r,null!==(t=o[this.indexName][this.$parent[this.localKey]])&&void 0!==t?t:[]);var a="".concat(this._lcModelClassName,"s"),i="".concat(this._lcThroughModelClassName,"s");return this.$parent[i].reduce((function(t,r){return t.push.apply(t,_toConsumableArray(r[a])),t}),[])}}]),HasManyThrough}(u);function HasMany_typeof(t){return(HasMany_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(t){return typeof t}:function _typeof(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function HasMany_defineProperties(t,r){for(var o=0;o<r.length;o++){var a=r[o];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}function HasMany_get(t,r,o){return(HasMany_get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function _get(t,r,o){var a=function HasMany_superPropBase(t,r){for(;!Object.prototype.hasOwnProperty.call(t,r)&&null!==(t=HasMany_getPrototypeOf(t)););return t}(t,r);if(a){var i=Object.getOwnPropertyDescriptor(a,r);return i.get?i.get.call(o):i.value}})(t,r,o||t)}function HasMany_setPrototypeOf(t,r){return(HasMany_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(t,r){return t.__proto__=r,t})(t,r)}function HasMany_createSuper(t){var r=function HasMany_isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function _createSuperInternal(){var o,a=HasMany_getPrototypeOf(t);if(r){var i=HasMany_getPrototypeOf(this).constructor;o=Reflect.construct(a,arguments,i)}else o=a.apply(this,arguments);return HasMany_possibleConstructorReturn(this,o)}}function HasMany_possibleConstructorReturn(t,r){return!r||"object"!==HasMany_typeof(r)&&"function"!=typeof r?function HasMany_assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):r}function HasMany_getPrototypeOf(t){return(HasMany_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var c=function(t){!function HasMany_inherits(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),r&&HasMany_setPrototypeOf(t,r)}(HasMany,t);var r=HasMany_createSuper(HasMany);function HasMany(t,o,a){var i;return function HasMany_classCallCheck(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}(this,HasMany),(i=r.call(this,t,o)).localKey=null!=a?a:"id",i}return function HasMany_createClass(t,r,o){return r&&HasMany_defineProperties(t.prototype,r),o&&HasMany_defineProperties(t,o),t}(HasMany,[{key:"setName",value:function setName(){var t=this.$parent.constructor.snakeCaseClassName(),r=this.model.snakeCaseClassName();return this.foreignKey="".concat(t,"_id"),this.$name="".concat(r,"s"),this}},{key:"getRelationalFields",value:function getRelationalFields(){return[]}},{key:"setParentProperties",value:function setParentProperties(){var t=this;return HasMany_get(HasMany_getPrototypeOf(HasMany.prototype),"setParentProperties",this).call(this),Object.defineProperty(this.$parent,"".concat(this.$name,"Count"),{get:function get(){return t.count}}),Object.defineProperty(this.$parent,"has".concat(this.model.className(),"s"),{get:function get(){return t.count>0}}),this}},{key:"count",get:function get(){var t,r,o;return null!==(r=null===(o=(null!==(t=globalThis.Store.database().indexes(this.model.className())[this.foreignKey])&&void 0!==t?t:{})[this.$parent[this.localKey]])||void 0===o?void 0:o.length)&&void 0!==r?r:0}},{key:"value",get:function get(){var t,r=this,o=this.model.className(),a=globalThis.Store.database().indexes(o);return Object.prototype.hasOwnProperty.call(a,this.foreignKey)?globalThis.Store.database().find(o,null!==(t=a[this.foreignKey][this.$parent[this.localKey]])&&void 0!==t?t:[]):globalThis.Store.database().all(this.model.className()).filter((function(t){return t[r.foreignKey]===r.$parent[r.localKey]}))},set:function set(t){}}]),HasMany}(u);function BelongTo_typeof(t){return(BelongTo_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(t){return typeof t}:function _typeof(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function _createForOfIteratorHelper(t,r){var o;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(o=function BelongTo_unsupportedIterableToArray(t,r){if(!t)return;if("string"==typeof t)return BelongTo_arrayLikeToArray(t,r);var o=Object.prototype.toString.call(t).slice(8,-1);"Object"===o&&t.constructor&&(o=t.constructor.name);if("Map"===o||"Set"===o)return Array.from(t);if("Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return BelongTo_arrayLikeToArray(t,r)}(t))||r&&t&&"number"==typeof t.length){o&&(t=o);var a=0,i=function F(){};return{s:i,n:function n(){return a>=t.length?{done:!0}:{done:!1,value:t[a++]}},e:function e(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var u,l=!0,c=!1;return{s:function s(){o=t[Symbol.iterator]()},n:function n(){var t=o.next();return l=t.done,t},e:function e(t){c=!0,u=t},f:function f(){try{l||null==o.return||o.return()}finally{if(c)throw u}}}}function BelongTo_arrayLikeToArray(t,r){(null==r||r>t.length)&&(r=t.length);for(var o=0,a=new Array(r);o<r;o++)a[o]=t[o];return a}function BelongTo_defineProperties(t,r){for(var o=0;o<r.length;o++){var a=r[o];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}function BelongTo_get(t,r,o){return(BelongTo_get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function _get(t,r,o){var a=function BelongTo_superPropBase(t,r){for(;!Object.prototype.hasOwnProperty.call(t,r)&&null!==(t=BelongTo_getPrototypeOf(t)););return t}(t,r);if(a){var i=Object.getOwnPropertyDescriptor(a,r);return i.get?i.get.call(o):i.value}})(t,r,o||t)}function BelongTo_setPrototypeOf(t,r){return(BelongTo_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(t,r){return t.__proto__=r,t})(t,r)}function BelongTo_createSuper(t){var r=function BelongTo_isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function _createSuperInternal(){var o,a=BelongTo_getPrototypeOf(t);if(r){var i=BelongTo_getPrototypeOf(this).constructor;o=Reflect.construct(a,arguments,i)}else o=a.apply(this,arguments);return BelongTo_possibleConstructorReturn(this,o)}}function BelongTo_possibleConstructorReturn(t,r){return!r||"object"!==BelongTo_typeof(r)&&"function"!=typeof r?function BelongTo_assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):r}function BelongTo_getPrototypeOf(t){return(BelongTo_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var p=function(t){!function BelongTo_inherits(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),r&&BelongTo_setPrototypeOf(t,r)}(BelongsTo,t);var r=BelongTo_createSuper(BelongsTo);function BelongsTo(t,o,a){return function BelongTo_classCallCheck(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}(this,BelongsTo),r.call(this,t,null!=o?o:"".concat(t.snakeCaseClassName(),"_id"),a)}return function BelongTo_createClass(t,r,o){return r&&BelongTo_defineProperties(t.prototype,r),o&&BelongTo_defineProperties(t,o),t}(BelongsTo,[{key:"setName",value:function setName(){var t,r=this.model.snakeCaseClassName();return this.$name=null!==(t=this.$name)&&void 0!==t?t:"".concat(r),this}},{key:"setParentProperties",value:function setParentProperties(){var t=this;BelongTo_get(BelongTo_getPrototypeOf(BelongsTo.prototype),"setParentProperties",this).call(this);var r,o="",a=_createForOfIteratorHelper(this.$name.split("_"));try{for(a.s();!(r=a.n()).done;){var i=r.value;o+=i[0].toUpperCase()+i.slice(1)}}catch(t){a.e(t)}finally{a.f()}return Object.defineProperty(this.$parent,"has".concat(o),{get:function get(){return null!==t.value}}),this}},{key:"value",get:function get(){return this.model.find(this.$parent[this.foreignKey])},set:function set(t){}}]),BelongsTo}(u);function MorphOne_typeof(t){return(MorphOne_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(t){return typeof t}:function _typeof(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function MorphOne_defineProperties(t,r){for(var o=0;o<r.length;o++){var a=r[o];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}function MorphOne_setPrototypeOf(t,r){return(MorphOne_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(t,r){return t.__proto__=r,t})(t,r)}function MorphOne_createSuper(t){var r=function MorphOne_isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function _createSuperInternal(){var o,a=MorphOne_getPrototypeOf(t);if(r){var i=MorphOne_getPrototypeOf(this).constructor;o=Reflect.construct(a,arguments,i)}else o=a.apply(this,arguments);return MorphOne_possibleConstructorReturn(this,o)}}function MorphOne_possibleConstructorReturn(t,r){return!r||"object"!==MorphOne_typeof(r)&&"function"!=typeof r?function MorphOne_assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):r}function MorphOne_getPrototypeOf(t){return(MorphOne_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var y=function(t){!function MorphOne_inherits(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),r&&MorphOne_setPrototypeOf(t,r)}(MorphOne,t);var r=MorphOne_createSuper(MorphOne);function MorphOne(t){return function MorphOne_classCallCheck(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}(this,MorphOne),r.call(this,t)}return function MorphOne_createClass(t,r,o){return r&&MorphOne_defineProperties(t.prototype,r),o&&MorphOne_defineProperties(t,o),t}(MorphOne,[{key:"getRelationalFields",value:function getRelationalFields(){return[]}},{key:"value",get:function get(){var t=this.$parent.constructor.className(),r=this.$parent.primaryKey,o="".concat(this.$name,"_id"),a="".concat(this.$name,"_type"),i={};return i[o]=r,i[a]=t,this.model.find(i)}}]),MorphOne}(u);function HasOne_typeof(t){return(HasOne_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(t){return typeof t}:function _typeof(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function HasOne_defineProperties(t,r){for(var o=0;o<r.length;o++){var a=r[o];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}function HasOne_get(t,r,o){return(HasOne_get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function _get(t,r,o){var a=function HasOne_superPropBase(t,r){for(;!Object.prototype.hasOwnProperty.call(t,r)&&null!==(t=HasOne_getPrototypeOf(t)););return t}(t,r);if(a){var i=Object.getOwnPropertyDescriptor(a,r);return i.get?i.get.call(o):i.value}})(t,r,o||t)}function HasOne_setPrototypeOf(t,r){return(HasOne_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(t,r){return t.__proto__=r,t})(t,r)}function HasOne_createSuper(t){var r=function HasOne_isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function _createSuperInternal(){var o,a=HasOne_getPrototypeOf(t);if(r){var i=HasOne_getPrototypeOf(this).constructor;o=Reflect.construct(a,arguments,i)}else o=a.apply(this,arguments);return HasOne_possibleConstructorReturn(this,o)}}function HasOne_possibleConstructorReturn(t,r){return!r||"object"!==HasOne_typeof(r)&&"function"!=typeof r?function HasOne_assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):r}function HasOne_getPrototypeOf(t){return(HasOne_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var h=function(t){!function HasOne_inherits(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),r&&HasOne_setPrototypeOf(t,r)}(HasOne,t);var r=HasOne_createSuper(HasOne);function HasOne(t){return function HasOne_classCallCheck(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}(this,HasOne),r.call(this,t)}return function HasOne_createClass(t,r,o){return r&&HasOne_defineProperties(t.prototype,r),o&&HasOne_defineProperties(t,o),t}(HasOne,[{key:"setName",value:function setName(){return this.foreignKey="".concat(this.$parent.constructor.snakeCaseClassName(),"_id"),this}},{key:"getRelationalFields",value:function getRelationalFields(){return[]}},{key:"setParentProperties",value:function setParentProperties(){var t=this;return HasOne_get(HasOne_getPrototypeOf(HasOne.prototype),"setParentProperties",this).call(this),Object.defineProperty(this.$parent,"has".concat(this.model.className()),{get:function get(){return null!==t.value}}),this}},{key:"value",get:function get(){var t,r=this.model.className(),o=globalThis.Store.database().indexes(r);if(!Object.prototype.hasOwnProperty.call(o,this.foreignKey))return null;var a=o[this.foreignKey];return Object.prototype.hasOwnProperty.call(a,this.$parent.primaryKey)?globalThis.Store.database().find(r,null!==(t=a[this.$parent.primaryKey][0])&&void 0!==t?t:null):null}}]),HasOne}(u);function HasOneThrough_typeof(t){return(HasOneThrough_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(t){return typeof t}:function _typeof(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function HasOneThrough_defineProperties(t,r){for(var o=0;o<r.length;o++){var a=r[o];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}function HasOneThrough_setPrototypeOf(t,r){return(HasOneThrough_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(t,r){return t.__proto__=r,t})(t,r)}function HasOneThrough_createSuper(t){var r=function HasOneThrough_isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function _createSuperInternal(){var o,a=HasOneThrough_getPrototypeOf(t);if(r){var i=HasOneThrough_getPrototypeOf(this).constructor;o=Reflect.construct(a,arguments,i)}else o=a.apply(this,arguments);return HasOneThrough_possibleConstructorReturn(this,o)}}function HasOneThrough_possibleConstructorReturn(t,r){return!r||"object"!==HasOneThrough_typeof(r)&&"function"!=typeof r?function HasOneThrough_assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):r}function HasOneThrough_getPrototypeOf(t){return(HasOneThrough_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var d=function(t){!function HasOneThrough_inherits(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),r&&HasOneThrough_setPrototypeOf(t,r)}(HasOneThrough,t);var r=HasOneThrough_createSuper(HasOneThrough);function HasOneThrough(t,o,a,i){var u;return function HasOneThrough_classCallCheck(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}(this,HasOneThrough),(u=r.call(this,t,a)).throughModel=o,u.localKey=null!=i?i:"id",u}return function HasOneThrough_createClass(t,r,o){return r&&HasOneThrough_defineProperties(t.prototype,r),o&&HasOneThrough_defineProperties(t,o),t}(HasOneThrough,[{key:"setName",value:function setName(){return this._lcThroughModelClassName=this.throughModel.snakeCaseClassName(),this._lcModelClassName=this.model.snakeCaseClassName(),this._lcParentClassName=this.$parent.constructor.snakeCaseClassName(),this.foreignKey="".concat(this._lcThroughModelClassName,"_id"),this.$name="".concat(this._lcModelClassName),this}},{key:"getRelationalFields",value:function getRelationalFields(){return[]}},{key:"indexName",get:function get(){return"".concat(this._lcThroughModelClassName,".").concat(this._lcParentClassName,"_id")}},{key:"value",get:function get(){var t;return null!==(t=this.$parent[this._lcThroughModelClassName][this._lcModelClassName])&&void 0!==t?t:null}}]),HasOneThrough}(u);function MorphTo_typeof(t){return(MorphTo_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(t){return typeof t}:function _typeof(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function MorphTo_createForOfIteratorHelper(t,r){var o;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(o=function MorphTo_unsupportedIterableToArray(t,r){if(!t)return;if("string"==typeof t)return MorphTo_arrayLikeToArray(t,r);var o=Object.prototype.toString.call(t).slice(8,-1);"Object"===o&&t.constructor&&(o=t.constructor.name);if("Map"===o||"Set"===o)return Array.from(t);if("Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return MorphTo_arrayLikeToArray(t,r)}(t))||r&&t&&"number"==typeof t.length){o&&(t=o);var a=0,i=function F(){};return{s:i,n:function n(){return a>=t.length?{done:!0}:{done:!1,value:t[a++]}},e:function e(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var u,l=!0,c=!1;return{s:function s(){o=t[Symbol.iterator]()},n:function n(){var t=o.next();return l=t.done,t},e:function e(t){c=!0,u=t},f:function f(){try{l||null==o.return||o.return()}finally{if(c)throw u}}}}function MorphTo_arrayLikeToArray(t,r){(null==r||r>t.length)&&(r=t.length);for(var o=0,a=new Array(r);o<r;o++)a[o]=t[o];return a}function MorphTo_defineProperties(t,r){for(var o=0;o<r.length;o++){var a=r[o];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}function MorphTo_setPrototypeOf(t,r){return(MorphTo_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(t,r){return t.__proto__=r,t})(t,r)}function MorphTo_createSuper(t){var r=function MorphTo_isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function _createSuperInternal(){var o,a=MorphTo_getPrototypeOf(t);if(r){var i=MorphTo_getPrototypeOf(this).constructor;o=Reflect.construct(a,arguments,i)}else o=a.apply(this,arguments);return MorphTo_possibleConstructorReturn(this,o)}}function MorphTo_possibleConstructorReturn(t,r){return!r||"object"!==MorphTo_typeof(r)&&"function"!=typeof r?function MorphTo_assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):r}function MorphTo_getPrototypeOf(t){return(MorphTo_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var b=function(t){!function MorphTo_inherits(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),r&&MorphTo_setPrototypeOf(t,r)}(MorphTo,t);var r=MorphTo_createSuper(MorphTo);function MorphTo(t){return function MorphTo_classCallCheck(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}(this,MorphTo),r.call(this,t)}return function MorphTo_createClass(t,r,o){return r&&MorphTo_defineProperties(t.prototype,r),o&&MorphTo_defineProperties(t,o),t}(MorphTo,[{key:"setFillPropertyOnParent",value:function setFillPropertyOnParent(){var t=this;Object.defineProperty(this.$parent,"_".concat(this.$name),{set:function set(r){Array.isArray(r)||(r=[r]);var o,a=t.$parent.constructor.snakeCaseClassName(),i="".concat(a,"_type"),u="".concat(a,"_id"),l=MorphTo_createForOfIteratorHelper(r);try{for(l.s();!(o=l.n()).done;){var c=o.value;c.id=c[u],globalThis.Store.classInstances[c[i]].constructor.insert(c)}}catch(t){l.e(t)}finally{l.f()}}})}},{key:"value",get:function get(){var t=this.$parent.constructor.snakeCaseClassName(),r=this.$parent["".concat(t,"_type")],o=this.$parent["".concat(t,"_id")];return globalThis.Store.classInstances[r].constructor.find(o)}}]),MorphTo}(a);function ownKeys(t,r){var o=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter((function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable}))),o.push.apply(o,a)}return o}function _defineProperty(t,r,o){return r in t?Object.defineProperty(t,r,{value:o,enumerable:!0,configurable:!0,writable:!0}):t[r]=o,t}function Model_toConsumableArray(t){return function Model_arrayWithoutHoles(t){if(Array.isArray(t))return Model_arrayLikeToArray(t)}(t)||function Model_iterableToArray(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||function Model_unsupportedIterableToArray(t,r){if(!t)return;if("string"==typeof t)return Model_arrayLikeToArray(t,r);var o=Object.prototype.toString.call(t).slice(8,-1);"Object"===o&&t.constructor&&(o=t.constructor.name);if("Map"===o||"Set"===o)return Array.from(t);if("Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return Model_arrayLikeToArray(t,r)}(t)||function Model_nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Model_arrayLikeToArray(t,r){(null==r||r>t.length)&&(r=t.length);for(var o=0,a=new Array(r);o<r;o++)a[o]=t[o];return a}function Model_defineProperties(t,r){for(var o=0;o<r.length;o++){var a=r[o];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}var g=function(){function Model(t){!function Model_classCallCheck(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}(this,Model),this.setFields(this.addRelationFields(t)),this._tmpId="_".concat(++globalThis.Store.numberOfModelCreated),this.snakeCaseName=this.constructor.snakeCaseClassName()}return function Model_createClass(t,r,o){return r&&Model_defineProperties(t.prototype,r),o&&Model_defineProperties(t,o),t}(Model,[{key:"tableSetup",value:function tableSetup(t){for(var r=0;r<this.numberOfFields;r++)this.originalFields[r]instanceof i&&this.originalFields[r].tableSetup(t);for(var o=0;o<this.numberOfFields;o++)this.originalFields[o]instanceof l&&this.originalFields[o].tableSetup(t)}},{key:"save",value:function save(){var t=this,r=this.constructor.className(),o=globalThis.Store.database(),a=o.ids(r);this.setPrimaryKey(),"_"!==this.primaryKey[0]&&a.includes(this._tmpId)&&o.delete(r,this._tmpId),this.dirtyFields.forEach((function(o){globalThis.Store.database().removeFromIndex(r,o.$name,o.previousValue,t.primaryKeyValue),t.fill(o.toJson()),globalThis.Store.database().addToIndex(r,o.$name,o.value,t.primaryKeyValue)})),a.includes(this.primaryKey+"")?o.update(r,this):o.insert(r,this)}},{key:"addNewIndex",value:function addNewIndex(t){globalThis.Store.database().addIndex(this.constructor.className(),t)}},{key:"removeFromIndex",value:function removeFromIndex(t){var r=this.constructor.className();globalThis.Store.database().removeFromIndex(r,t.foreignKey,t.previousValue,this.primaryKey)}},{key:"addToIndex",value:function addToIndex(t){var r=this.constructor.className();globalThis.Store.database().addToIndex(r,t.foreignKey,t.fieldValue,this.primaryKey)}},{key:"fill",value:function fill(t){this.fillPrimaryKey(t);for(var r=0;r<this.numberOfFields;r++)if(!(this.originalFields[r]instanceof u)){var o=this.originalFields[r].$name;void 0!==t[o]&&(this["_".concat(o)]=t[o])}}},{key:"fillPrimaryKey",value:function fillPrimaryKey(t){for(var r=0;r<this.numberOfFields;r++)if(!0===this.originalFields[r].isPrimary){var o=this.originalFields[r].$name;void 0!==t[o]&&(this["_".concat(o)]=t[o])}this.setPrimaryKey()}},{key:"fillRelations",value:function fillRelations(t){for(var r=0;r<this.numberOfFields;r++)if(this.originalFields[r]instanceof u){var o=this.originalFields[r].$name;void 0!==t[o]&&(this["_".concat(o)]=t[o])}}},{key:"setPrimaryKey",value:function setPrimaryKey(){if(1!==this.primaryFields.length){for(var t="",r=0;r<this.primaryFields.length;r++)r>0&&(t+="-"),t+=this[this.primaryFields[r].$name];this.primaryKeyValue=t}else{var o;this.primaryKeyValue=null!==(o=this[this.primaryFields[0].$name])&&void 0!==o?o:null}}},{key:"isDirty",value:function isDirty(t){return t?this.dirtyFieldNames.includes(t):this.dirtyFields.length>0}},{key:"resetDirty",value:function resetDirty(){this.originalFields.filter((function(t){return!(t instanceof u)})).forEach((function(t){t.resetDirty()}))}},{key:"addRelationFields",value:function addRelationFields(t){var r=Model_toConsumableArray(t);return t.forEach((function(t,o){t instanceof u&&r.splice.apply(r,[o,0].concat(Model_toConsumableArray(t.getRelationalFields())))})),this.numberOfFields=r.length,r}},{key:"setFields",value:function setFields(t){var r=this;this.originalFields=Model_toConsumableArray(t),this.numberOfFields=this.originalFields.length;for(var o=0;o<this.numberOfFields;o++)this.originalFields[o].setup(this);return Object.defineProperty(this,"indexedFields",{get:function get(){return r.originalFields.filter((function(t){return t instanceof i})).reduce((function(t,r){return t.push(r.$name),t}),[])}}),this.primaryFields=this.originalFields.filter((function(t){return t.isPrimary})),this}},{key:"toJson",value:function toJson(t){for(var r={},o=0;o<this.originalFields.length;o++){var a=this.originalFields[o];a instanceof u&&t||(r[a.$name]=a.value,r[a.$name]instanceof Model?r[a.$name]=r[a.$name].toJson(!0):r[a.$name]instanceof Array&&(r[a.$name]=Model_toConsumableArray(r[a.$name].map((function(t){var r;return null!==(r=null==t?void 0:t.toJson(!0))&&void 0!==r?r:t})))))}return function _objectSpread(t){for(var r=1;r<arguments.length;r++){var o=null!=arguments[r]?arguments[r]:{};r%2?ownKeys(Object(o),!0).forEach((function(r){_defineProperty(t,r,o[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(o)):ownKeys(Object(o)).forEach((function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(o,r))}))}return t}({},r)}},{key:"primaryKey",get:function get(){var t,r;return null!==(t=null!==(r=this.primaryKeyValue)&&void 0!==r?r:this._tmpId)&&void 0!==t?t:null}},{key:"primaryKeyName",get:function get(){return this.originalFields.filter((function(t){return t.isPrimary})).map((function(t){return t.$name}))}},{key:"dirtyFields",get:function get(){return this.originalFields.filter((function(t){return t.isDirty}))}},{key:"dirtyFieldNames",get:function get(){return this.dirtyFields.map((function(t){return t.$name}))}}],[{key:"snakeCaseClassName",value:function snakeCaseClassName(){return this.name[0].toLowerCase()+this.name.slice(1).replace(/([A-Z])/g,"_$1").toLowerCase()}},{key:"kebabCaseClassName",value:function kebabCaseClassName(){return this.name[0].toLowerCase()+this.name.slice(1).replace(/([A-Z])/g,"-$1").toLowerCase()}},{key:"className",value:function className(){return this.name}},{key:"addIndex",value:function addIndex(t){globalThis.Store.database().addIndex(this.className(),t)}},{key:"getInstance",value:function getInstance(){var t,r=null!==(t=globalThis.Store.classInstances[this.className()])&&void 0!==t?t:globalThis.Store.classInstances[this.className()]=new this,o=r.originalFields.reduce((function(t,r){return t.push(Object.assign(Object.create(Object.getPrototypeOf(r)),r)),t}),[]);return Object.create(Object.getPrototypeOf(r)).setFields(o)}},{key:"aSyncInsert",value:function aSyncInsert(t){var r=this;return new Promise((function(o){requestAnimationFrame((function(){o(r.insert(t))}))}))}},{key:"insert",value:function insert(t){for(var r=(t=Array.isArray(t)?t:[t]).length,o=0;o<r;o++){var a=t[o],i=this.getInstance();i.fill(a),globalThis.Store.database().insert(this.className(),i),i.fillRelations(a),t[o]=i}return t}},{key:"update",value:function update(t){var r=new this;return r.fill(t),globalThis.Store.database().update(this.className(),r),r}},{key:"find",value:function find(t){return globalThis.Store.database().find(this.className(),t)}},{key:"select",value:function select(t){try{return globalThis.Store.database().select(this.className(),t)}catch(t){console.error(t)}}},{key:"delete",value:function _delete(t){globalThis.Store.database().delete(this.className(),t)}},{key:"all",value:function all(){return globalThis.Store.database().all(this.className())}},{key:"ids",value:function ids(){return globalThis.Store.database().ids(this.className())}}]),Model}();function Collection_typeof(t){return(Collection_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(t){return typeof t}:function _typeof(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Collection_toConsumableArray(t){return function Collection_arrayWithoutHoles(t){if(Array.isArray(t))return Collection_arrayLikeToArray(t)}(t)||function Collection_iterableToArray(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||function Collection_unsupportedIterableToArray(t,r){if(!t)return;if("string"==typeof t)return Collection_arrayLikeToArray(t,r);var o=Object.prototype.toString.call(t).slice(8,-1);"Object"===o&&t.constructor&&(o=t.constructor.name);if("Map"===o||"Set"===o)return Array.from(t);if("Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return Collection_arrayLikeToArray(t,r)}(t)||function Collection_nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Collection_arrayLikeToArray(t,r){(null==r||r>t.length)&&(r=t.length);for(var o=0,a=new Array(r);o<r;o++)a[o]=t[o];return a}function Collection_classCallCheck(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}function Collection_defineProperties(t,r){for(var o=0;o<r.length;o++){var a=r[o];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}function Collection_possibleConstructorReturn(t,r){return!r||"object"!==Collection_typeof(r)&&"function"!=typeof r?function Collection_assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):r}function _wrapNativeSuper(t){var r="function"==typeof Map?new Map:void 0;return(_wrapNativeSuper=function _wrapNativeSuper(t){if(null===t||!function _isNativeFunction(t){return-1!==Function.toString.call(t).indexOf("[native code]")}(t))return t;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==r){if(r.has(t))return r.get(t);r.set(t,Wrapper)}function Wrapper(){return _construct(t,arguments,Collection_getPrototypeOf(this).constructor)}return Wrapper.prototype=Object.create(t.prototype,{constructor:{value:Wrapper,enumerable:!1,writable:!0,configurable:!0}}),Collection_setPrototypeOf(Wrapper,t)})(t)}function _construct(t,r,o){return(_construct=Collection_isNativeReflectConstruct()?Reflect.construct:function _construct(t,r,o){var a=[null];a.push.apply(a,r);var i=new(Function.bind.apply(t,a));return o&&Collection_setPrototypeOf(i,o.prototype),i}).apply(null,arguments)}function Collection_isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}function Collection_setPrototypeOf(t,r){return(Collection_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(t,r){return t.__proto__=r,t})(t,r)}function Collection_getPrototypeOf(t){return(Collection_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var v=function(t){!function Collection_inherits(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),r&&Collection_setPrototypeOf(t,r)}(Collection,t);var r=function Collection_createSuper(t){var r=Collection_isNativeReflectConstruct();return function _createSuperInternal(){var o,a=Collection_getPrototypeOf(t);if(r){var i=Collection_getPrototypeOf(this).constructor;o=Reflect.construct(a,arguments,i)}else o=a.apply(this,arguments);return Collection_possibleConstructorReturn(this,o)}}(Collection);function Collection(){Collection_classCallCheck(this,Collection);for(var t=arguments.length,o=new Array(t),a=0;a<t;a++)o[a]=arguments[a];return r.call.apply(r,[this].concat(o))}return function Collection_createClass(t,r,o){return r&&Collection_defineProperties(t.prototype,r),o&&Collection_defineProperties(t,o),t}(Collection,[{key:"_getRowFieldResult",value:function _getRowFieldResult(t,r){for(var o,a=null!==(o=t[r[0]])&&void 0!==o?o:null,i=1;i<r.length;i++){var u,l=r[i];if(null===a)break;if(a instanceof Collection)return a.pluck(r[i]);a=null!==(u=a[l])&&void 0!==u?u:null}return a}},{key:"pluck",value:function pluck(t,r){var o=t.split(".");if(r){var a=r.split("."),i={};for(var u in this)i[this._getRowFieldResult(this[u],a)]=this._getRowFieldResult(this[u],o);return i}var l=[];for(var c in this)l.push(this._getRowFieldResult(this[c],o));return l}},{key:"first",value:function first(){var t;return null!==(t=this[0])&&void 0!==t?t:null}},{key:"last",value:function last(){var t;return null!==(t=this.slice(-1)[0])&&void 0!==t?t:null}},{key:"merge",value:function merge(t){return this.push.apply(this,Collection_toConsumableArray(t)),this}},{key:"random",value:function random(){return this[Math.round((this.length-1)*Math.random())]}},{key:"unique",value:function unique(t){var unique={};for(var r in this)unique[this[r][t]]=this[r];return _construct(Collection,Collection_toConsumableArray(Object.values(unique)))}},{key:"whereIfFunction",value:function whereIfFunction(t,r){var o=new Collection;for(var a in this)r(t,this[a])&&o.push(this[a]);return o}},{key:"where",value:function where(t,r,o){var a;o=null!==(a=o)&&void 0!==a?a:r,r=r===o?"==":r;var i={">":function _(t,r){return t>r},">=":function _(t,r){return t>=r},"<":function _(t,r){return t<r},"<=":function _(t,r){return t<=r},"!=":function _(t,r){return t!=r},"==":function _(t,r){return t==r}};if(!Object.prototype.hasOwnProperty.call(i,r))throw new Error("Invalid comparison operator used");return this.whereIfFunction(t,(function(t,a){return i[r](a[t],o)}))}},{key:"whereBetween",value:function whereBetween(t,r){return this.whereIfFunction(t,(function(t,o){var a=o[t];return a>=r[0]&&a<=r[1]}))}},{key:"whereNotBetween",value:function whereNotBetween(t,r){return this.whereIfFunction(t,(function(t,o){var a=o[t];return!(a>=r[0]&&a<=r[1])}))}},{key:"whereNull",value:function whereNull(t){return this.whereIfFunction(t,(function(t,r){return null===r[t]}))}},{key:"whereNotNull",value:function whereNotNull(t){return this.whereIfFunction(t,(function(t,r){return null!==r[t]}))}},{key:"whereIn",value:function whereIn(t,r){return this.whereIfFunction(t,(function(t,o){return r.includes(o[t])}))}},{key:"whereNotIn",value:function whereNotIn(t,r){return this.whereIfFunction(t,(function(t,o){return!r.includes(o[t])}))}},{key:"whereInstanceOf",value:function whereInstanceOf(t){return this.whereIfFunction(null,(function(r,o){return o instanceof t}))}},{key:"whereNotInstanceOf",value:function whereNotInstanceOf(t){return this.whereIfFunction(null,(function(r,o){return!(o instanceof t)}))}}]),Collection}(_wrapNativeSuper(Array));function Table_construct(t,r,o){return(Table_construct=Table_isNativeReflectConstruct()?Reflect.construct:function _construct(t,r,o){var a=[null];a.push.apply(a,r);var i=new(Function.bind.apply(t,a));return o&&Table_setPrototypeOf(i,o.prototype),i}).apply(null,arguments)}function Table_isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}function Table_setPrototypeOf(t,r){return(Table_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(t,r){return t.__proto__=r,t})(t,r)}function Table_toConsumableArray(t){return function Table_arrayWithoutHoles(t){if(Array.isArray(t))return Table_arrayLikeToArray(t)}(t)||function Table_iterableToArray(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||function Table_unsupportedIterableToArray(t,r){if(!t)return;if("string"==typeof t)return Table_arrayLikeToArray(t,r);var o=Object.prototype.toString.call(t).slice(8,-1);"Object"===o&&t.constructor&&(o=t.constructor.name);if("Map"===o||"Set"===o)return Array.from(t);if("Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return Table_arrayLikeToArray(t,r)}(t)||function Table_nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Table_arrayLikeToArray(t,r){(null==r||r>t.length)&&(r=t.length);for(var o=0,a=new Array(r);o<r;o++)a[o]=t[o];return a}function Table_defineProperties(t,r){for(var o=0;o<r.length;o++){var a=r[o];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}var m=function(){function Table(t){!function Table_classCallCheck(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}(this,Table),this.setup(t.getInstance())}return function Table_createClass(t,r,o){return r&&Table_defineProperties(t.prototype,r),o&&Table_defineProperties(t,o),t}(Table,[{key:"setup",value:function setup(t){this.model=t,this.indexedFields=t.indexedFields,this.name=t.constructor.className(),this.models={},this.indexes={},this.splittedIndexNames={},this.primaryKeyFieldNames=t.primaryKeyName}},{key:"setupIndexes",value:function setupIndexes(){this.model.tableSetup(this)}},{key:"allModels",value:function allModels(){return this.models}},{key:"ids",value:function ids(){return Object.keys(this.models)}},{key:"all",value:function all(){for(var t=Object.values(this.models),r=t.length,o=new v,a=0;a<r;a+=1e4)o.push.apply(o,Table_toConsumableArray(t.slice(a,a+1e4)));return o}},{key:"insert",value:function insert(t){if(Object.prototype.hasOwnProperty.call(this.models,t.primaryKey))throw new Error("Record already exists");if(!(t instanceof g))throw new Error("Record should be instance of model");t.resetDirty(),null!=t.primaryKey&&(this.models[t.primaryKey]=t),this.addValueToIndexes(t)}},{key:"addValueToIndexes",value:function addValueToIndexes(t){var r=this.indexes;for(var o in r){for(var a=this.splittedIndexNames[o],i=this.splittedIndexNames[o].length,u=t,l=0;l<i;l++){if(null===u[a[l]]){u=void 0;break}u=u[a[l]]}void 0!==u&&(void 0!==r[o][u]?-1===r[o][u].indexOf(t.primaryKey)&&r[o][u].push(t.primaryKey):r[o][u]=[t.primaryKey])}}},{key:"update",value:function update(t){if(!Object.prototype.hasOwnProperty.call(this.models,t.primaryKey))throw new Error("Record doesn't exists");if(!(t instanceof g))throw new Error("Record should be instance of model");t.resetDirty(),this.models[t.primaryKey]=t}},{key:"getKey",value:function getKey(t){if("string"==typeof t)return t;if(null===t)return null;for(var r=[],o=0;o<this.primaryKeyFieldNames.length;o++){var a;r.push(null!==(a=t[this.primaryKeyFieldNames[o]])&&void 0!==a?a:"")}return r.join("-")}},{key:"find",value:function find(t){var r,o,a=this,i=this.primaryKeyFieldNames.length>1;if(Array.isArray(t)){for(var u=[],l=i?function(r){var o;u.push(null!==(o=a.models[a.getKey(t[r])])&&void 0!==o?o:null)}:function(r){var o;u.push(null!==(o=a.models[t[r]])&&void 0!==o?o:null)},c=0;c<t.length;c++)l(c);return Table_construct(v,u)}return i?null!==(o=this.models[this.getKey(t)])&&void 0!==o?o:null:null!==(r=this.models[t])&&void 0!==r?r:null}},{key:"select",value:function select(t){if(!Object.prototype.hasOwnProperty.call(this.models,t))throw new Error("Record doesn't exists");return this.models[t]}},{key:"delete",value:function _delete(t){if(!Object.prototype.hasOwnProperty.call(this.models,t))throw new Error("Record doesn't exists");delete this.models[t]}},{key:"removeFromIndex",value:function removeFromIndex(t,r,o){if(Object.prototype.hasOwnProperty.call(this.indexes,t)&&Object.prototype.hasOwnProperty.call(this.indexes[t],r+"")){var a=this.indexes[t][r].indexOf(o);-1!==a&&(this.indexes[t][r].splice(a,1),0===this.indexes[t][r].length&&delete this.indexes[t][r])}}},{key:"addToIndex",value:function addToIndex(t,r,o){Object.prototype.hasOwnProperty.call(this.indexes,t)&&(void 0!==this.indexes[t][r]?this.indexes[t][r].includes(o)||this.indexes[t][r].push(o):this.indexes[t][r]=[o])}},{key:"addIndex",value:function addIndex(t){t in this.indexes==!1&&(this.indexedFields.push(t),this.splittedIndexNames[t]=t.split("."),this.indexes[t]={})}},{key:"truncate",value:function truncate(){for(var t in this.models={},this.indexes)this.indexes[t]={}}},{key:"load",value:function load(){}}]),Table}();function Database_defineProperties(t,r){for(var o=0;o<r.length;o++){var a=r[o];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}var O=function(){function Database(t,r){var o=this;!function Database_classCallCheck(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}(this,Database),this.name=t,this.tables={},r.forEach((function(t){var r=new m(t);o.tables[r.name]=r}))}return function Database_createClass(t,r,o){return r&&Database_defineProperties(t.prototype,r),o&&Database_defineProperties(t,o),t}(Database,[{key:"setIndexes",value:function setIndexes(){Object.values(this.tables).forEach((function(t){t.setupIndexes()}))}},{key:"showTables",value:function showTables(){return Object.keys(this.tables)}},{key:"ids",value:function ids(t){return this.tables[t].ids()}},{key:"all",value:function all(t){return this.tables[t].all()}},{key:"allModels",value:function allModels(t){return this.tables[t].allModels()}},{key:"addIndex",value:function addIndex(t,r){this.tables[t].addIndex(r)}},{key:"addToIndex",value:function addToIndex(t,r,o,a){return this.tables[t].addToIndex(r,o,a)}},{key:"removeFromIndex",value:function removeFromIndex(t,r,o,a){return this.tables[t].removeFromIndex(r,o,a)}},{key:"indexes",value:function indexes(t){return this.tables[t].indexes}},{key:"insert",value:function insert(t,r){return this.tables[t].insert(r)}},{key:"update",value:function update(t,r){return this.tables[t].update(r)}},{key:"find",value:function find(t,r){return this.tables[t].find(r)}},{key:"select",value:function select(t,r){return this.tables[t].select(r)}},{key:"delete",value:function _delete(t,r){return this.tables[t].delete(r)}},{key:"drop",value:function drop(t){delete this.tables[t]}},{key:"truncate",value:function truncate(t){return this.tables[t].truncate()}},{key:"query",value:function query(t){var r=t.match(/^((SELECT)|(INSERT)|(DELETE))\s+(.*)\s+FROM\s+([^\s]+)(\s+WHERE\s+([^\s]+)\s+(=)\s+([^\s+]))?((\s+)|;)?$/i);if(0===r.length)return null;var o=r[1],a=r[6],i=r[8],u=r[10];return"id"===i?this[o.toLowerCase()](a,u):void 0===i&&"SELECT"===o?this.all(a):null}}]),Database}();function ConnectionAdapter_defineProperties(t,r){for(var o=0;o<r.length;o++){var a=r[o];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}var P=function(){function ConnectionAdapter(t){!function ConnectionAdapter_classCallCheck(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}(this,ConnectionAdapter),this.options=t}return function ConnectionAdapter_createClass(t,r,o){return r&&ConnectionAdapter_defineProperties(t.prototype,r),o&&ConnectionAdapter_defineProperties(t,o),t}(ConnectionAdapter,[{key:"load",value:function load(t){throw t.className(),new Error("should be extended")}},{key:"put",value:function put(){throw new Error("should be extended")}},{key:"patch",value:function patch(){throw new Error("should be extended")}},{key:"post",value:function post(){throw new Error("should be extended")}},{key:"delete",value:function _delete(){throw new Error("should be extended")}}]),ConnectionAdapter}();function QueueMessage_defineProperties(t,r){for(var o=0;o<r.length;o++){var a=r[o];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}var C=function(){function QueueMessage(t,r,o){!function QueueMessage_classCallCheck(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}(this,QueueMessage),this.model=t,this.action=r,this.data=o}return function QueueMessage_createClass(t,r,o){return r&&QueueMessage_defineProperties(t.prototype,r),o&&QueueMessage_defineProperties(t,o),t}(QueueMessage,[{key:"addCallback",value:function addCallback(t){this.callback=t}},{key:"execute",value:function execute(){var t;this.model[this.action](this.data),(null!==(t=this.callback)&&void 0!==t?t:function(){})()}}]),QueueMessage}();function ConnectionAdapterJsonRequest_typeof(t){return(ConnectionAdapterJsonRequest_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(t){return typeof t}:function _typeof(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function ConnectionAdapterJsonRequest_defineProperties(t,r){for(var o=0;o<r.length;o++){var a=r[o];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}function ConnectionAdapterJsonRequest_setPrototypeOf(t,r){return(ConnectionAdapterJsonRequest_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(t,r){return t.__proto__=r,t})(t,r)}function ConnectionAdapterJsonRequest_createSuper(t){var r=function ConnectionAdapterJsonRequest_isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function _createSuperInternal(){var o,a=ConnectionAdapterJsonRequest_getPrototypeOf(t);if(r){var i=ConnectionAdapterJsonRequest_getPrototypeOf(this).constructor;o=Reflect.construct(a,arguments,i)}else o=a.apply(this,arguments);return ConnectionAdapterJsonRequest_possibleConstructorReturn(this,o)}}function ConnectionAdapterJsonRequest_possibleConstructorReturn(t,r){return!r||"object"!==ConnectionAdapterJsonRequest_typeof(r)&&"function"!=typeof r?function ConnectionAdapterJsonRequest_assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):r}function ConnectionAdapterJsonRequest_getPrototypeOf(t){return(ConnectionAdapterJsonRequest_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var T=function(t){!function ConnectionAdapterJsonRequest_inherits(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),r&&ConnectionAdapterJsonRequest_setPrototypeOf(t,r)}(ConnectionAdapterJsonRequest,t);var r=ConnectionAdapterJsonRequest_createSuper(ConnectionAdapterJsonRequest);function ConnectionAdapterJsonRequest(t){return function ConnectionAdapterJsonRequest_classCallCheck(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}(this,ConnectionAdapterJsonRequest),r.call(this,t)}return function ConnectionAdapterJsonRequest_createClass(t,r,o){return r&&ConnectionAdapterJsonRequest_defineProperties(t.prototype,r),o&&ConnectionAdapterJsonRequest_defineProperties(t,o),t}(ConnectionAdapterJsonRequest,[{key:"load",value:function load(t){var r=this;return new Promise((function(o){var a,i,u,l=null!==(a=r.options.method)&&void 0!==a?a:"GET",c="".concat(r.options.url,"/").concat(t.kebabCaseClassName()),p=null!==(i=null===(u=r.options)||void 0===u?void 0:u.formatter)&&void 0!==i?i:function(t){return t},y=new XMLHttpRequest;y.open(l,c,!0),y.addEventListener("load",(function(){if(4==y.readyState){var r=p(JSON.parse(y.responseText)),a=new C(t,"insert",r);o(a)}})),y.send(null)}))}},{key:"isRemote",get:function get(){return!0}},{key:"isLocal",get:function get(){return!1}}]),ConnectionAdapterJsonRequest}(P);function ConnectionAdapterLocalStorage_typeof(t){return(ConnectionAdapterLocalStorage_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(t){return typeof t}:function _typeof(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function ConnectionAdapterLocalStorage_defineProperties(t,r){for(var o=0;o<r.length;o++){var a=r[o];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}function ConnectionAdapterLocalStorage_setPrototypeOf(t,r){return(ConnectionAdapterLocalStorage_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(t,r){return t.__proto__=r,t})(t,r)}function ConnectionAdapterLocalStorage_createSuper(t){var r=function ConnectionAdapterLocalStorage_isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function _createSuperInternal(){var o,a=ConnectionAdapterLocalStorage_getPrototypeOf(t);if(r){var i=ConnectionAdapterLocalStorage_getPrototypeOf(this).constructor;o=Reflect.construct(a,arguments,i)}else o=a.apply(this,arguments);return ConnectionAdapterLocalStorage_possibleConstructorReturn(this,o)}}function ConnectionAdapterLocalStorage_possibleConstructorReturn(t,r){return!r||"object"!==ConnectionAdapterLocalStorage_typeof(r)&&"function"!=typeof r?function ConnectionAdapterLocalStorage_assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):r}function ConnectionAdapterLocalStorage_getPrototypeOf(t){return(ConnectionAdapterLocalStorage_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var w=function(t){!function ConnectionAdapterLocalStorage_inherits(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),r&&ConnectionAdapterLocalStorage_setPrototypeOf(t,r)}(ConnectionAdapterLocalArray,t);var r=ConnectionAdapterLocalStorage_createSuper(ConnectionAdapterLocalArray);function ConnectionAdapterLocalArray(t){return function ConnectionAdapterLocalStorage_classCallCheck(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}(this,ConnectionAdapterLocalArray),r.call(this,t)}return function ConnectionAdapterLocalStorage_createClass(t,r,o){return r&&ConnectionAdapterLocalStorage_defineProperties(t.prototype,r),o&&ConnectionAdapterLocalStorage_defineProperties(t,o),t}(ConnectionAdapterLocalArray,[{key:"load",value:function load(t){var r=this;return new Promise((function(o){o(new C(t,"aSyncInsert",r.getTableFromLocalStorage(t)))}))}},{key:"getLocalStorageKey",value:function getLocalStorageKey(t){return"jeloquent-".concat(globalThis.Store.use,"-").concat(t.className)}},{key:"getTableFromLocalStorage",value:function getTableFromLocalStorage(t){var r;return JSON.parse(null!==(r=localStorage.getItem(this.getLocalStorageKey(t)))&&void 0!==r?r:"[]")}},{key:"post",value:function post(t,r){localStorage.setItem(this.getLocalStorageKey(t),JSON.stringify(r))}}]),ConnectionAdapterLocalArray}(P);function ConnectionAdapterFactory_defineProperties(t,r){for(var o=0;o<r.length;o++){var a=r[o];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}var S=function(){function ConnectionAdapterFactory(){!function ConnectionAdapterFactory_classCallCheck(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}(this,ConnectionAdapterFactory)}return function ConnectionAdapterFactory_createClass(t,r,o){return r&&ConnectionAdapterFactory_defineProperties(t.prototype,r),o&&ConnectionAdapterFactory_defineProperties(t,o),t}(ConnectionAdapterFactory,null,[{key:"getAdapter",value:function getAdapter(t,r){return"jsonRequest"===t?new T(r):"localStorage"===t||"localArray"===t?new w(r):new T(r)}}]),ConnectionAdapterFactory}();function Connection_defineProperties(t,r){for(var o=0;o<r.length;o++){var a=r[o];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}var k=function(){function Connection(t,r){!function Connection_classCallCheck(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}(this,Connection),this.adapter=t instanceof P?t:S.getAdapter(t,r),this.updateQueue=[],this.paused=!1}return function Connection_createClass(t,r,o){return r&&Connection_defineProperties(t.prototype,r),o&&Connection_defineProperties(t,o),t}(Connection,[{key:"processQueue",value:function processQueue(){var t,r=this,o=(null!==(t=this.updateQueue)&&void 0!==t?t:[]).shift();o&&(o.execute(),setTimeout((function(){r.processQueue()}),1))}},{key:"addToQueue",value:function addToQueue(){var t;(t=this.updateQueue).push.apply(t,arguments)}},{key:"pause",value:function pause(){this.paused=!0}},{key:"resume",value:function resume(){this.paused=!1}},{key:"load",value:function load(t){var r=this;return new Promise((function(o){r.adapter.load(t).then((function(t){t.addCallback(o),r.addToQueue(t),setTimeout((function(){r.processQueue(o)}),1)}))}))}}]),Connection}();function Store_defineProperties(t,r){for(var o=0;o<r.length;o++){var a=r[o];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}var R=function(){function Store(){!function Store_classCallCheck(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}(this,Store),this.classInstances={},this.databases={},this.connetions={},this.numberOfModelCreated=0,this.useDatabase="default",this.useConnection="default",globalThis.Store=this}return function Store_createClass(t,r,o){return r&&Store_defineProperties(t.prototype,r),o&&Store_defineProperties(t,o),t}(Store,[{key:"use",value:function use(t){var r,o;this.useDatabase=t,null===(r=this.databases[null!==(o=this.useDatabase)&&void 0!==o?o:"default"])||void 0===r||r.setIndexes()}},{key:"add",value:function add(t){this.databases[t.name]=t}},{key:"addConnections",value:function addConnections(t,r){this.connetions[null!=r?r:"default"]=t}},{key:"useConnection",value:function useConnection(t){this.useConnection=null!=t?t:"default"}},{key:"database",value:function database(){var t;return null!==(t=this.databases[this.useDatabase])&&void 0!==t?t:null}},{key:"connection",value:function connection(){return this.connetions[this.useConnection]}}]),Store}()}])}));