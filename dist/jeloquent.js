var k=Object.defineProperty;var n=(l,e)=>k(l,"name",{value:e,configurable:!0});var c=class{constructor(e,t){this.isPrimary=t!=null?t:!1,this.$name=e,this.$fieldValue=null,this.$previousValue=void 0,this.$originalValue=void 0,this.$parent=null}get isDirty(){return this.$fieldValue!=this.$previousValue}get originalValue(){return this.$originalValue}get previousValue(){return this.$previousValue}get value(){return this.$fieldValue}set value(e){this.$fieldValue=e}setName(){return this}setup(e){return this.$parent=e,this.setName().setParentProperties()}tableSetup(){}addParentFieldValueLookUp(){Object.defineProperty(this.$parent,this.$name,{get:()=>this.value,set:e=>{var t,s;this.$previousValue===void 0&&(this.$previousValue=JSON.parse(JSON.stringify((t=this.value)!=null?t:e))),this.$originalValue===void 0&&(this.$originalValue=JSON.parse(JSON.stringify((s=this.value)!=null?s:e))),this.$previousValue=JSON.parse(JSON.stringify(this.value)),this.value=e}})}addParentOriginalValueLookUp(){Object.defineProperty(this.$parent,`original_${this.$name}`,{get:()=>this.originalValue})}setParentProperties(){return this.addParentFieldValueLookUp(),this.addParentOriginalValueLookUp(),this.setFillPropertyOnParent(),this}setFillPropertyOnParent(){Object.defineProperty(this.$parent,`_${this.$name}`,{set:e=>{this.$originalValue===void 0&&(this.$originalValue=JSON.parse(JSON.stringify(this.value))),this.$previousValue=JSON.parse(JSON.stringify(this.value)),this.$fieldValue=e}})}resetDirty(){this.$originalValue=JSON.parse(JSON.stringify(this.$fieldValue)),this.$previousValue=JSON.parse(JSON.stringify(this.$fieldValue))}toJson(){let e={};return e[this.$name]=this.value,JSON.parse(JSON.stringify(e))}};n(c,"Field");var d=class extends c{constructor(e,t){super(e);this.foreignKey=e!=null?e:t}setRelation(e){return this.relation=e,this}get value(){return this.$fieldValue}set value(e){this.$fieldValue=e}tableSetup(e){e.registerIndex(this.foreignKey)}};n(d,"ForeignKey");var u=class extends c{constructor(e,t,s){let i=s!=null?s:e.snakeCaseClassName;super(i);this.model=e,this.foreignKey=t}tableSetup(e){e.registerIndex(this.foreignKey)}getRelationalFields(){return[new d(this.foreignKey).setRelation(this)]}setFillPropertyOnParent(){Object.defineProperty(this.$parent,`_${this.$name}`,{set:e=>{Array.isArray(e)||(e=[e]),e.forEach(t=>{this.model.ids().includes(t.id)||this.model.insert(t)})}})}};n(u,"Relation");var y=class extends u{constructor(e,t,s,i){super(e,s);this.model=e,this.throughModel=t,this.localKey=i!=null?i:"id"}get indexName(){return`${this._lcThroughModelClassName}.${this._lcParentClassName}_id`}get value(){return this.getValueByParentKey("primaryKey")}get originalValue(){return this.getValueByParentKey("originalPrimaryKey")}getValueByParentKey(e){var s,i;let t=this.model.getIndexByKey(this.indexName);return globalThis.Store.database().find(this.model.className,[...(i=(s=t.get(this.$parent[e]))==null?void 0:s.values())!=null?i:[]])}setName(){return this._lcThroughModelClassName=this.throughModel.snakeCaseClassName,this._lcModelClassName=this.model.snakeCaseClassName,this._lcParentClassName=this.$parent.snakeCaseClassName,this.foreignKey=`${this._lcThroughModelClassName}_id`,this.$name=`${this._lcModelClassName}s`,this}tableSetup(){this.model.registerIndex(this.indexName)}getRelationalFields(){return[]}};n(y,"HasManyThrough");var $=class extends u{constructor(e,t,s){super(e,t);this.localKey=s!=null?s:"id"}get count(){var t,s;return(s=(t=globalThis.Store.database().indexes(this.model.className).get(this.foreignKey).get(this.$parent.primaryKey))==null?void 0:t.size)!=null?s:0}get value(){return this.getValueByParentKey("primaryKey")}get originalValue(){return this.getValueByParentKey("originalPrimaryKey")}getValueByParentKey(e){var s,i;let t=this.model.getIndexByKey(this.foreignKey);return globalThis.Store.database().find(this.model.className,[...(i=(s=t.get(this.$parent[e]))==null?void 0:s.values())!=null?i:[]])}setName(){let e=this.$parent.snakeCaseClassName,t=this.model.snakeCaseClassName;return this.foreignKey=`${e}_id`,this.$name=`${t}s`,this}getRelationalFields(){return[]}setParentProperties(){return super.setParentProperties(),Object.defineProperty(this.$parent,`${this.$name}Count`,{get:()=>this.count}),Object.defineProperty(this.$parent,`has${this.model.className}s`,{get:()=>this.count>0}),this}};n($,"HasMany");var x=class extends u{constructor(e,t,s){super(e,t!=null?t:`${e.snakeCaseClassName}_id`,s)}get value(){return this.model.find(this.$parent[this.foreignKey])}get originalValue(){return this.model.find(this.$parent[`original_${this.foreignKey}`])}set value(e){}setName(){var t;let e=this.model.snakeCaseClassName;return this.$name=(t=this.$name)!=null?t:`${e}`,this}setParentProperties(){super.setParentProperties();let e="";for(let t of this.$name.split("_"))e+=t[0].toUpperCase()+t.slice(1);return Object.defineProperty(this.$parent,`has${e}`,{get:()=>this.value!==null}),this}};n(x,"BelongsTo");var C=class extends u{constructor(e){super(e)}get value(){return this.getValueByParentKey("primaryKey")}get originalValue(){return this.getValueByParentKey("originalPrimaryKey")}getValueByParentKey(e){let t=this.$parent.className,s=this.$parent[e],i=`${this.$name}_id`,r=`${this.$name}_type`,a={};return a[i]=s,a[r]=t,this.model.find(a)}getRelationalFields(){return[]}};n(C,"MorphOne");var S=class extends u{constructor(e){super(e)}get value(){return this.getValueByParentKey("primaryKey")}get originalValue(){return this.getValueByParentKey("originalPrimaryKey")}getValueByParentKey(e){var s,i;let t=this.model.getIndexByKey(this.foreignKey);return globalThis.Store.database().find(this.model.className,[...(i=(s=t.get(this.$parent[e]))==null?void 0:s.values())!=null?i:[]]).first()}setName(){return this.foreignKey=`${this.$parent.snakeCaseClassName}_id`,this}getRelationalFields(){return[]}setParentProperties(){return super.setParentProperties(),Object.defineProperty(this.$parent,`has${this.model.className}`,{get:()=>this.value!==null}),this}};n(S,"HasOne");var w=class extends u{constructor(e,t,s,i){super(e,s);this.throughModel=t,this.localKey=i!=null?i:"id"}get value(){var t;return(t=this.$parent[this._lcThroughModelClassName][this._lcModelClassName])!=null?t:null}get originalValue(){var t;return(t=this.$parent[`original_${this._lcThroughModelClassName}`][`original_${this._lcModelClassName}`])!=null?t:null}get indexName(){return`${this._lcThroughModelClassName}.${this._lcParentClassName}_id`}setName(){return this._lcThroughModelClassName=this.throughModel.snakeCaseClassName,this._lcModelClassName=this.model.snakeCaseClassName,this._lcParentClassName=this.$parent.snakeCaseClassName,this.foreignKey=`${this._lcThroughModelClassName}_id`,this.$name=`${this._lcModelClassName}`,this}getRelationalFields(){return[]}};n(w,"HasOneThrough");var P=class extends c{constructor(e){super(e)}get value(){let e=this.$parent.snakeCaseClassName,t=this.$parent[`${e}_type`],s=this.$parent[`${e}_id`];return globalThis.Store.classInstances[t].constructor.find(s)}setFillPropertyOnParent(){Object.defineProperty(this.$parent,`_${this.$name}`,{set:e=>{Array.isArray(e)||(e=[e]);let t=this.$parent.snakeCaseClassName,s=`${t}_type`,i=`${t}_id`;for(let r of e)r.id=r[i],globalThis.Store.classInstances[r[s]].constructor.insert(r)}})}};n(P,"MorphTo");var g=class{constructor(){this.indexes=new Map,this.indexedFields=new Set,this.splitIndexNames=new Map}static registerIndex(e,t){this.register(e,t)}static register(e,t){globalThis.Store.database().registerIndex(e.className,t)}static addIndex(e,t){this.add(e,t)}static add(e,t){globalThis.Store.database().addIndex(e.className,t.foreignKey,t.fieldValue,e.primaryKey)}static removeIndex(e,t){this.remove(e,t)}static remove(e,t){globalThis.Store.database().removeIndex(e.className,t.foreignKey,t.previousValue,e.primaryKey)}static removeTmpIdFromIndex(e){let t=e.className;e.dirtyFields.filter(s=>s instanceof d).forEach(s=>{globalThis.Store.database().removeIndex(t,s.$name,s.originalValue,e._tmpId)})}getIndexByKey(e){return this.indexes.get(e)}registerIndex(e){this.indexes.has(e)||(this.indexedFields.add(e),this.splitIndexNames.set(e,e.split(".")),this.indexes.set(e,new Map))}addValue(e,t,s){var r;if(!this.indexes.has(e)||s===null)return;let i=(r=this.indexes)==null?void 0:r.get(e);if(!i.has(t)){this.registerLookUpKey(e,t,s);return}i=i==null?void 0:i.get(t),!i.has(s)&&i.add(s)}removeValue(e,t,s){var i,r,a;(a=(r=(i=this.indexes)==null?void 0:i.get(e))==null?void 0:r.get(t))==null||a.delete(s)}registerLookUpKey(e,t,s){var i,r;(r=(i=this.indexes)==null?void 0:i.get(e))==null||r.set(t,new Set([s]))}unregisterLookUpKey(e,t){var s,i;(i=(s=this.indexes)==null?void 0:s.get(e))==null||i.delete(t)}getLookUpValue(e,t){let s=this.splitIndexNames.get(t),i=e;for(let r of s){if(i[`original_${r}`]===null)break;i=i[`original_${r}`]}return i!=null?i:null}addValueByModel(e){for(let[t]of this.indexes)this.addValue(t,this.getLookUpValue(e,t),e.primaryKey)}removeValueByModel(e){for(let[t]of this.indexes)this.removeValue(t,this.getLookUpValue(e,t),e.primaryKey)}truncate(){for(let e in this.indexes)this.indexes.get(e).clear()}};n(g,"Index");var K=class{constructor(e=[]){this.setFields(this.addRelationFields(e)),this._tmpId=`_${++globalThis.Store.numberOfModelCreated}`}get className(){return this.constructor.className}get primaryKey(){var e,t;return(t=(e=this.primaryFields.reduce((s,i,r)=>r>0?`${s}-${i.value}`:i.value,""))!=null?e:this._tmpId)!=null?t:null}get originalPrimaryKey(){var e,t;return(t=(e=this.primaryFields.reduce((s,i,r)=>r>0?`${s}-${i.originalValue}`:i.originalValue,""))!=null?e:this._tmpId)!=null?t:null}get primaryKeyName(){return this.originalFields.filter(e=>e.isPrimary).map(e=>e.$name)}get originalValues(){return this.originalFields.reduce((e,t)=>(t.originalValue!==void 0&&(e[t.$name]=t.originalValue),e),{})}get dirtyFields(){return this.originalFields.filter(e=>e.isDirty)}get dirtyFieldNames(){return this.dirtyFields.map(e=>e.$name)}get snakeCaseClassName(){return this.constructor.snakeCaseClassName}get kebabCaseClassName(){return this.constructor.kebabCaseClassName}static get snakeCaseClassName(){return this.snakeCaseName||(this.snakeCaseName=this.name[0].toLowerCase()+this.name.slice(1).replace(/([A-Z])/g,"_$1").toLowerCase()),this.snakeCaseName}static get kebabCaseClassName(){return this.kebabCaseName||(this.kebabCaseName=this.name[0].toLowerCase()+this.name.slice(1).replace(/([A-Z])/g,"-$1").toLowerCase()),this.kebabCaseName}static get className(){return this.name}static getInstance(){var s;let e=(s=globalThis.Store.classInstances[this.className])!=null?s:globalThis.Store.classInstances[this.className]=new this,t=e.originalFields.reduce((i,r)=>(i.push(Object.assign(Object.create(Object.getPrototypeOf(r)),r)),i),[]);return Object.create(Object.getPrototypeOf(e)).setFields(t)}static registerIndex(e){g.registerIndex(this.getInstance(),e)}static getIndexByKey(e){let t=this.className;return globalThis.Store.database().getIndexByKey(t,e)}static aSyncInsert(e){return new Promise(t=>{requestAnimationFrame(()=>{t(this.insert(e))})})}static insert(e){e=Array.isArray(e)?e:[e];let t=e.length;for(let s=0;s<t;s++){let i=e[s],r=this.getInstance();r.fill(i),globalThis.Store.database().insert(this.className,r),r.fillRelations(i),e[s]=r}return e}static update(e){let t=new this;return t.fill(e),globalThis.Store.database().update(this.className,t),t}static delete(e){globalThis.Store.database().delete(this.className,e)}static find(e){return globalThis.Store.database().find(this.className,e)}static select(e){try{return globalThis.Store.database().select(this.className,e)}catch(t){console.error(t)}}static all(){return globalThis.Store.database().all(this.className)}static ids(){return globalThis.Store.database().ids(this.className)}tableSetup(e){for(let t=0;t<this.numberOfFields;t++)this.originalFields[t]instanceof d&&this.originalFields[t].tableSetup(e),this.originalFields[t]instanceof y&&this.originalFields[t].tableSetup(e)}isDirty(e){return e?this.dirtyFieldNames.includes(e):this.dirtyFields.length>0}resetDirty(){this.originalFields.filter(e=>!(e instanceof u)).forEach(e=>{e.resetDirty()})}delete(){this.constructor.delete(this.primaryKey)}save(){let e=this.className,t=globalThis.Store.database(),s=t.ids(e);if(this.primaryKey[0]!=="_"&&s.includes(this._tmpId)&&(g.removeTmpIdFromIndex(this),t.delete(e,this._tmpId)),s.includes(this.primaryKey)){t.update(e,this);return}t.insert(e,this)}registerIndex(e){g.registerIndex(this,e)}fill(e){for(let t=0;t<this.numberOfFields;t++)if(!(this.originalFields[t]instanceof u)){let s=this.originalFields[t].$name;e[s]!==void 0&&(this[`_${s}`]=e[s])}}fillRelations(e){for(let t=0;t<this.numberOfFields;t++)if(this.originalFields[t]instanceof u){let s=this.originalFields[t].$name;e[s]!==void 0&&(this[`_${s}`]=e[s])}}addRelationFields(e){let t=[...e];return e.forEach((s,i)=>{s instanceof u&&t.splice(i,0,...s.getRelationalFields())}),this.numberOfFields=t.length,t}setFields(e){this.originalFields=[...e],this.numberOfFields=this.originalFields.length;for(let t=0;t<this.numberOfFields;t++)this.originalFields[t].setup(this);return Object.defineProperty(this,"indexedFields",{get:()=>this.originalFields.filter(t=>t instanceof d).reduce((t,s)=>(t.add(s.$name),t),new Set)}),this.primaryFields=this.originalFields.filter(t=>t.isPrimary),this}jsonStringify(){return JSON.stringify(this.toObject())}toJSON(){return this.toObject()}toObject(e=!1){let t={};for(let s=0;s<this.originalFields.length;s++){let i=this.originalFields[s];if(!(i instanceof u&&e)){if(t[i.$name]=i.value,t[i.$name]instanceof K){t[i.$name]=t[i.$name].toObject(!0);continue}t[i.$name]instanceof Array&&(t[i.$name]=[...t[i.$name].map(r=>{var a;return(a=r==null?void 0:r.toObject(!0))!=null?a:r})])}}return{...t}}},b=K;n(b,"Model"),"constructor";var m=class extends Array{constructor(...e){super(...e)}_getRowFieldResult(e,t){var i,r;let s=(i=e[t[0]])!=null?i:null;for(let a=1;a<t.length;a++){let h=t[a];if(s===null)break;if(s instanceof m)return s.pluck(t[a]);s=(r=s[h])!=null?r:null}return s}pluck(e,t){let s=e.split(".");if(t){let r=t.split("."),a={};for(let h in this)a[this._getRowFieldResult(this[h],r)]=this._getRowFieldResult(this[h],s);return a}let i=[];for(let r in this)i.push(this._getRowFieldResult(this[r],s));return i}first(){var e;return(e=this[0])!=null?e:null}last(){var e;return(e=this.slice(-1)[0])!=null?e:null}merge(e){return this.push(...e),this}random(){return this[Math.round((this.length-1)*Math.random())]}unique(e){let t={};for(let s in this)t[this[s][e]]=this[s];return new m(...Object.values(t))}jsonStringify(){return JSON.stringify(this)}whereIfFunction(e,t){let s=new m;for(let i in this)t(e,this[i])&&s.push(this[i]);return s}where(e,t,s){s=s!=null?s:t,t=t===s?"==":t;let i={">"(r,a){return r>a},">="(r,a){return r>=a},"<"(r,a){return r<a},"<="(r,a){return r<=a},"!="(r,a){return r!=a},"=="(r,a){return r==a}};if(!Object.prototype.hasOwnProperty.call(i,t))throw new Error("Invalid comparison operator used");return this.whereIfFunction(e,(r,a)=>i[t](a[r],s))}whereBetween(e,t){return this.whereIfFunction(e,(s,i)=>{let r=i[s];return r>=t[0]&&r<=t[1]})}whereNotBetween(e,t){return this.whereIfFunction(e,(s,i)=>{let r=i[s];return!(r>=t[0]&&r<=t[1])})}whereNull(e){return this.whereIfFunction(e,(t,s)=>s[t]===null)}whereNotNull(e){return this.whereIfFunction(e,(t,s)=>s[t]!==null)}whereIn(e,t){return this.whereIfFunction(e,(s,i)=>t.includes(i[s]))}whereNotIn(e,t){return this.whereIfFunction(e,(s,i)=>!t.includes(i[s]))}whereInstanceOf(e){return this.whereIfFunction(null,(t,s)=>s instanceof e)}whereNotInstanceOf(e){return this.whereIfFunction(null,(t,s)=>!(s instanceof e))}};n(m,"Collection");var f=class{constructor(e){this.setup(e.getInstance())}setup(e){this.model=e,this.name=e.className,this.models=new Map,this.index=new g,this.primaryKeyFieldNames=e.primaryKeyName}setupIndexes(){this.model.tableSetup(this)}registerIndex(e){this.index.registerIndex(e)}addIndex(e,t,s){this.index.addValue(e,t,s)}removeIndex(e,t,s){this.index.removeValue(e,t,s)}getIndexByKey(e){return this.index.getIndexByKey(e)}get indexes(){return this.index.indexes}allModels(){return this.models}ids(){return[...this.models.keys()]}all(){let e=[...this.models.values()],t=e.length,s=new m;for(let i=0;i<t;i+=1e4)s.push(...e.slice(i,i+1e4));return s}insert(e){if(this.models.has(e.primaryKey))throw new Error("Record already exists");if(!(e instanceof b))throw new Error("Record should be instance of model");e.resetDirty(),e.primaryKey!=null&&this.models.set(e.primaryKey,e),this.index.addValueByModel(e)}update(e){if(!this.models.has(e.primaryKey))throw new Error("Record doesn't exists");if(!(e instanceof b))throw new Error("Record should be instance of model");this.index.removeValueByModel(e),e.resetDirty(),this.index.addValueByModel(e),this.models.set(e.primaryKey,e)}delete(e){if(!this.models.has(e))throw new Error("Record doesn't exists");this.index.removeValueByModel(this.find(e)),this.models.delete(e)}truncate(){this.models.clear(),this.index.truncate()}getKey(e){var s;if(typeof e=="string")return e;if(e===null)return null;let t=[];for(let i=0;i<this.primaryKeyFieldNames.length;i++)t.push((s=e[this.primaryKeyFieldNames[i]])!=null?s:"");return t.join("-")}find(e){var s,i;let t=this.primaryKeyFieldNames.length>1;if(Array.isArray(e)){let r=[],a=t?h=>{var N;r.push((N=this.models.get(this.getKey(e[h])))!=null?N:null)}:h=>{var N;r.push((N=this.models.get(e[h]))!=null?N:null)};for(let h=0;h<e.length;h++)a(h);return new m(...r)}return t?(s=this.models.get(this.getKey(e)))!=null?s:null:(i=this.models.get(e))!=null?i:null}select(e){if(!this.models.has(e))throw new Error("Record doesn't exists");return this.find(e)}};n(f,"Table");var F=class{constructor(e,t){this.name=e,this.tables={},t.forEach(s=>{let i=new f(s);this.tables[i.name]=i})}setIndexes(){Object.values(this.tables).forEach(e=>{e.setupIndexes()})}showTables(){return Object.keys(this.tables)}ids(e){return this.tables[e].ids()}all(e){return this.tables[e].all()}allModels(e){return this.tables[e].allModels()}registerIndex(e,t){this.tables[e].registerIndex(t)}addIndex(e,t,s,i){return this.tables[e].addIndex(t,s,i)}removeIndex(e,t,s,i){return this.tables[e].removeIndex(t,s,i)}getIndexByKey(e,t){return this.tables[e].getIndexByKey(t)}unregisterLookUpKey(e,t,s){this.tables[e].unregisterLookUpKey(t,s)}indexes(e){return this.tables[e].indexes}insert(e,t){return this.tables[e].insert(t)}update(e,t){return this.tables[e].update(t)}find(e,t){return this.tables[e].find(t)}select(e,t){return this.tables[e].select(t)}delete(e,t){return this.tables[e].delete(t)}drop(e){delete this.tables[e]}truncate(e){return this.tables[e].truncate()}query(e){let t=e.match(/^((SELECT)|(INSERT)|(DELETE))\s+(.*)\s+FROM\s+([^\s]+)(\s+WHERE\s+([^\s]+)\s+(=)\s+([^\s+]))?((\s+)|;)?$/i);if(t.length===0)return null;let s=t[1],i=t[6],r=t[8],a=t[10];return r==="id"?this[s.toLowerCase()](i,a):r===void 0&&s==="SELECT"?this.all(i):null}};n(F,"Database");var o=class{constructor(e,t,s){this.model=e,this.action=t,this.data=s}addCallback(e){this.callback=e}execute(){var e;this.model[this.action](this.data),((e=this.callback)!=null?e:()=>null)()}};n(o,"QueueMessage");var p=class{constructor(e){this.connectionRequestSettings=e}modelApiLocation(e){return`${this.connectionRequestSettings.getBaseUrl()}/${e.kebabCaseClassName}`}post(e){return fetch(this.modelApiLocation(e),{method:"POST",body:JSON.stringify(e.jsonStringify()),...this.connectionRequestSettings.getSettings()})}all(e){return fetch(`${this.modelApiLocation(e)}`,{method:"GET",...this.connectionRequestSettings.getSettings()})}get(e){return fetch(`${this.modelApiLocation(e)}/${e.primaryKey}`,{method:"GET",...this.connectionRequestSettings.getSettings()})}patch(e){return fetch(`${this.modelApiLocation(e)}/${e.primaryKey}`,{method:"PATCH",body:JSON.stringify(e.dirtyFields),...this.connectionRequestSettings.getSettings()})}put(e){return fetch(`${this.modelApiLocation(e)}/`,{method:"PUT",body:JSON.stringify(e.jsonStringify()),...this.connectionRequestSettings.getSettings()})}delete(e){return fetch(`${this.modelApiLocation(e)}/${e.primaryKey}`,{method:"DELETE",...this.connectionRequestSettings.getSettings()})}};n(p,"ConnectionRequest");var I=class{constructor(e){this.connectionSettings=e}get isRemote(){return!0}get isLocal(){return!1}load(e){return this.all(e)}responseJson(e){return e.json()}all(e){return new Promise(t=>{new p(this.connectionSettings).all(e).then(s=>this.responseJson(s)).then(s=>{let i=new o(e,"insert",s);t(i)})})}get(e){return new Promise(t=>{new p(this.connectionSettings).get(e).then(s=>this.responseJson(s)).then(s=>{let i=new o(e,"fill",s);t(i)})})}post(e){return new Promise(t=>{new p(this.connectionSettings).post(e).then(s=>this.responseJson(s)).then(s=>{let i=new o(e,"fill",s);t(i)})})}put(e){return new Promise(t=>{new p(this.connectionSettings).put(e).then(s=>this.responseJson(s)).then(s=>{let i=new o(e,"fill",s);t(i)})})}patch(e){return new Promise(t=>{new p(this.connectionSettings).patch(e).then(s=>this.responseJson(s)).then(s=>{let i=new o(e,"fill",s);t(i)})})}delete(e){return new Promise(t=>{new p(this.connectionSettings).delete(e).then(s=>this.responseJson(s)).then(s=>{let i=new o(e,"delete",s);t(i)})})}};n(I,"JsonRequestAdapter");var M=class{constructor(e){this.connectionSettings=e}all(e){return Promise.resolve(t=>{t(new o(e,"aSyncUpdate",this.getTableFromLocalStorage(e)))})}delete(e){return Promise.resolve(t=>{t(new o(e,"aSyncUpdate",this.getTableFromLocalStorage(e)))})}get(e){return Promise.resolve(t=>{t(new o(e,"aSyncUpdate",this.getTableFromLocalStorage(e)))})}patch(e){return Promise.resolve(t=>{t(new o(e,"aSyncUpdate",this.getTableFromLocalStorage(e)))})}put(e){return Promise.resolve(t=>{t(new o(e,"aSyncUpdate",this.getTableFromLocalStorage(e)))})}load(e){return Promise.resolve(new Promise(t=>{t(new o(e,"aSyncInsert",this.getTableFromLocalStorage(e)))}))}post(e){return new Promise(t=>{t(new o(e,"aSyncInsert",this.getTableFromLocalStorage(e)))})}getLocalStorageKey(e){return`jeloquent-${globalThis.Store.useDatabase}-${e.className}`}getTableFromLocalStorage(e){var t;return JSON.parse((t=localStorage.getItem(this.getLocalStorageKey(e)))!=null?t:"[]")}};n(M,"LocalStorageAdapter");var O=class{constructor(e){this.connectionSettings=e}load(e){return new Promise(t=>{t(new o(e,"insert",this.options[e.className]))})}all(e){return new Promise(t=>{t(new o(e,"insert",this.options[e.className]))})}delete(e){return new Promise(t=>{t(new o(e,"insert",this.options[e.className]))})}get(e){return new Promise(t=>{t(new o(e,"insert",this.options[e.className]))})}patch(e){return new Promise(t=>{t(new o(e,"insert",this.options[e.className]))})}post(e){return new Promise(t=>{t(new o(e,"insert",this.options[e.className()]))})}put(e){return new Promise(t=>{t(new o(e,"insert",this.options[e.className()]))})}};n(O,"LocalArrayAdapter");var T=class{static getAdapter(e,t){return e==="jsonRequest"?new I(t):e==="localStorage"?new M(t):e==="localArray"?new O(t):new I(t)}};n(T,"ConnectionAdapterFactory");var V=class{constructor(e,t){e instanceof String?this.adapter=T.getAdapter(e,t):this.adapter=e,this.updateQueue=[],this.paused=!1}processQueue(){var t;let e=((t=this.updateQueue)!=null?t:[]).shift();!e||(e.execute(),setTimeout(()=>{this.processQueue()},1))}addToQueue(...e){this.updateQueue.push(...e)}pause(){this.paused=!0}resume(){this.paused=!1}load(e){return this.all(e)}all(e){return new Promise(t=>{this.adapter.all(e).then(s=>{s.addCallback(t),this.addToQueue(s),setTimeout(()=>{this.processQueue()},1)})})}post(e){return new Promise(t=>{this.adapter.post(e).then(s=>{s.addCallback(t),this.addToQueue(s),setTimeout(()=>{this.processQueue()},1)})})}put(e){return new Promise(t=>{this.adapter.put(e).then(s=>{s.addCallback(t),this.addToQueue(s),setTimeout(()=>{this.processQueue()},1)})})}patch(e){return new Promise(t=>{this.adapter.patch(e).then(s=>{s.addCallback(t),this.addToQueue(s),setTimeout(()=>{this.processQueue()},1)})})}delete(e){return new Promise(t=>{this.adapter.delete(e).then(s=>{s.addCallback(t),this.addToQueue(s),setTimeout(()=>{this.processQueue()},1)})})}};n(V,"Connection");var v=class{constructor(){this.classInstances={},this.databases=new Map,this.connections=new Map,this.numberOfModelCreated=0,this.useDatabase="default",this.useConnectionName="default",globalThis.Store=this}use(e="default"){var t;this.useDatabase=e,(t=this.databases.get(this.useDatabase))==null||t.setIndexes()}add(e){this.databases.set(e.name,e)}addConnection(e,t="default"){this.connections.set(t,e)}useConnections(e){this.useConnection(e)}useConnection(e="default"){this.useConnectionName=e}database(){var e;return(e=this.databases.get(this.useDatabase))!=null?e:null}connection(){var e;return(e=this.connections.get(this.useConnectionName))!=null?e:null}};n(v,"Store");export{x as BelongsTo,m as Collection,V as Connection,T as ConnectionAdapterFactory,F as Database,c as Field,d as ForeignKey,$ as HasMany,y as HasManyThrough,S as HasOne,w as HasOneThrough,b as Model,C as MorphOne,P as MorphTo,o as QueueMessage,u as Relation,v as Store,f as Table};
